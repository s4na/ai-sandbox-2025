<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¶ç©ºã®ç”»åƒç·¨é›†ãƒ„ãƒ¼ãƒ« - PhotoEdit Helper</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            position: relative;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.95;
        }

        .help-button {
            position: absolute;
            top: 0;
            right: -100px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid white;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .help-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .main-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 30px;
            max-width: 1400px;
            width: 100%;
            position: relative;
        }

        .tutorial-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 9999;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .tutorial-overlay.active {
            display: flex;
        }

        .tutorial-highlight {
            position: absolute;
            border: 3px solid #ffeb3b;
            border-radius: 8px;
            box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.5);
            z-index: 10000;
            pointer-events: none;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .tutorial-tooltip {
            position: absolute;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 10001;
            max-width: 350px;
        }

        .tutorial-tooltip h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .tutorial-tooltip p {
            color: #666;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .tutorial-buttons {
            display: flex;
            gap: 10px;
        }

        .tutorial-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .tutorial-btn-next {
            background: #667eea;
            color: white;
        }

        .tutorial-btn-next:hover {
            background: #764ba2;
        }

        .tutorial-btn-skip {
            background: #e0e0e0;
            color: #666;
        }

        .tutorial-btn-skip:hover {
            background: #d0d0d0;
        }

        .help-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 9998;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .help-modal.active {
            display: flex;
        }

        .help-content {
            background: white;
            border-radius: 15px;
            max-width: 900px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .help-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px 15px 0 0;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .help-header h2 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .help-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 24px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s;
        }

        .help-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .help-tabs {
            display: flex;
            background: #f5f5f5;
            border-bottom: 1px solid #ddd;
            position: sticky;
            top: 120px;
            z-index: 9;
        }

        .help-tab {
            flex: 1;
            padding: 15px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #666;
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
        }

        .help-tab:hover {
            background: #ebebeb;
        }

        .help-tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: white;
        }

        .help-body {
            padding: 30px;
        }

        .help-section {
            display: none;
        }

        .help-section.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .feature-card {
            background: #f8f9ff;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .feature-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .feature-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        .feature-description {
            color: #666;
            font-size: 14px;
            line-height: 1.5;
        }

        .shortcut-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .shortcut-table th {
            background: #f5f5f5;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #333;
        }

        .shortcut-table td {
            padding: 12px;
            border-bottom: 1px solid #eee;
        }

        .shortcut-key {
            display: inline-block;
            padding: 4px 8px;
            background: #e0e0e0;
            border-radius: 4px;
            font-family: monospace;
            font-weight: 600;
        }

        .faq-item {
            margin-bottom: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
        }

        .faq-question {
            width: 100%;
            text-align: left;
            padding: 15px 20px;
            background: #f8f9ff;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
        }

        .faq-question:hover {
            background: #e8ebff;
        }

        .faq-question.active {
            background: #667eea;
            color: white;
        }

        .faq-arrow {
            transition: transform 0.3s;
        }

        .faq-question.active .faq-arrow {
            transform: rotate(180deg);
        }

        .faq-answer {
            padding: 0 20px;
            max-height: 0;
            overflow: hidden;
            transition: all 0.3s;
        }

        .faq-answer.active {
            padding: 20px;
            max-height: 500px;
        }

        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            background: #f8f9ff;
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 30px;
            position: relative;
        }

        .upload-area.dragover {
            background: #e8ebff;
            border-color: #764ba2;
            transform: scale(1.02);
        }

        .upload-area.has-image {
            display: none;
        }

        .help-icon {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 30px;
            height: 30px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
        }

        .help-icon:hover {
            background: #764ba2;
            transform: scale(1.1);
        }

        .tooltip {
            position: absolute;
            background: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
            z-index: 1000;
        }

        .tooltip.active {
            opacity: 1;
        }

        .tooltip::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-top: 5px solid #333;
        }

        .upload-icon {
            font-size: 3rem;
            color: #667eea;
            margin-bottom: 20px;
        }

        .upload-text {
            color: #666;
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        .upload-subtext {
            color: #999;
            font-size: 0.9rem;
        }

        input[type="file"] {
            display: none;
        }

        .editor-container {
            display: none;
            grid-template-columns: 1fr 350px;
            gap: 30px;
            align-items: start;
        }

        .editor-container.active {
            display: grid;
        }

        .preview-container {
            background: #f5f5f5;
            border-radius: 10px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .canvas-wrapper {
            position: relative;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border-radius: 8px;
            overflow: hidden;
        }

        canvas {
            display: block;
            max-width: 100%;
            height: auto;
        }

        .controls-panel {
            background: #f8f9ff;
            border-radius: 10px;
            padding: 25px;
            position: relative;
        }

        .control-group {
            margin-bottom: 25px;
            position: relative;
        }

        .control-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            font-size: 0.95rem;
        }

        .control-value {
            color: #667eea;
            font-weight: normal;
            font-size: 0.9rem;
        }

        .slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
            cursor: pointer;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.4);
            transition: transform 0.2s;
        }

        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }

        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.4);
            transition: transform 0.2s;
        }

        .slider::-moz-range-thumb:hover {
            transform: scale(1.2);
        }

        .hue-slider {
            background: linear-gradient(to right, 
                hsl(0, 100%, 50%) 0%, 
                hsl(60, 100%, 50%) 17%, 
                hsl(120, 100%, 50%) 33%, 
                hsl(180, 100%, 50%) 50%, 
                hsl(240, 100%, 50%) 67%, 
                hsl(300, 100%, 50%) 83%, 
                hsl(360, 100%, 50%) 100%);
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            padding-top: 25px;
            border-top: 2px solid #e5e5e5;
        }

        .btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f5f5f5;
            color: #666;
        }

        .btn-secondary:hover {
            background: #e8e8e8;
        }

        .filter-presets {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 25px;
        }

        .filter-btn {
            padding: 10px;
            background: #f5f5f5;
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            font-size: 12px;
            font-weight: 600;
            color: #666;
            position: relative;
        }

        .filter-btn:hover {
            background: #e8ebff;
            border-color: #667eea;
        }

        .filter-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .onboarding-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10002;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .onboarding-modal.active {
            display: flex;
        }

        .onboarding-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            text-align: center;
        }

        .onboarding-title {
            font-size: 2rem;
            color: #667eea;
            margin-bottom: 20px;
        }

        .onboarding-description {
            color: #666;
            line-height: 1.8;
            margin-bottom: 30px;
        }

        .onboarding-features {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .onboarding-feature {
            display: flex;
            align-items: center;
            gap: 10px;
            text-align: left;
        }

        .onboarding-feature-icon {
            font-size: 1.5rem;
        }

        .onboarding-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .floating-help {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
            transition: all 0.3s;
            z-index: 1000;
        }

        .floating-help:hover {
            transform: scale(1.1);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.5);
        }

        .floating-help.pulse {
            animation: helpPulse 2s infinite;
        }

        @keyframes helpPulse {
            0%, 100% { 
                box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
            }
            50% { 
                box-shadow: 0 10px 50px rgba(102, 126, 234, 0.8);
            }
        }

        @media (max-width: 768px) {
            .editor-container {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }

            .help-button {
                position: static;
                margin-top: 20px;
            }

            .feature-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- åˆå›èµ·å‹•æ™‚ã®ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚° -->
    <div class="onboarding-modal" id="onboardingModal">
        <div class="onboarding-content">
            <h2 class="onboarding-title">ğŸ¨ æ¶ç©ºã® PhotoEdit Helper ã¸ã‚ˆã†ã“ãï¼</h2>
            <p class="onboarding-description">
                åˆã‚ã¦ã®æ–¹ã§ã‚‚ç°¡å˜ã«ä½¿ãˆã‚‹ç”»åƒç·¨é›†ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚<br>
                è±Šå¯Œãªãƒ˜ãƒ«ãƒ—æ©Ÿèƒ½ã¨ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§ã€ãƒ—ãƒ­ä¸¦ã¿ã®ç·¨é›†ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚
            </p>
            <div class="onboarding-features">
                <div class="onboarding-feature">
                    <span class="onboarding-feature-icon">ğŸ“š</span>
                    <span>è©³ç´°ãªãƒ˜ãƒ«ãƒ—ã‚¬ã‚¤ãƒ‰</span>
                </div>
                <div class="onboarding-feature">
                    <span class="onboarding-feature-icon">ğŸ¯</span>
                    <span>ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«</span>
                </div>
                <div class="onboarding-feature">
                    <span class="onboarding-feature-icon">ğŸ’¡</span>
                    <span>ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—è¡¨ç¤º</span>
                </div>
                <div class="onboarding-feature">
                    <span class="onboarding-feature-icon">âŒ¨ï¸</span>
                    <span>ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆä¸€è¦§</span>
                </div>
            </div>
            <div class="onboarding-buttons">
                <button class="btn btn-primary" onclick="startTutorial()">ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’é–‹å§‹</button>
                <button class="btn btn-secondary" onclick="skipOnboarding()">ã‚¹ã‚­ãƒƒãƒ—</button>
            </div>
        </div>
    </div>

    <!-- ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
    <div class="tutorial-overlay" id="tutorialOverlay"></div>
    <div class="tutorial-highlight" id="tutorialHighlight" style="display: none;"></div>
    <div class="tutorial-tooltip" id="tutorialTooltip" style="display: none;">
        <h3 id="tutorialTitle">ã‚¹ãƒ†ãƒƒãƒ—ã‚¿ã‚¤ãƒˆãƒ«</h3>
        <p id="tutorialText">èª¬æ˜ãƒ†ã‚­ã‚¹ãƒˆ</p>
        <div class="tutorial-buttons">
            <button class="tutorial-btn tutorial-btn-skip" onclick="skipTutorial()">ã‚¹ã‚­ãƒƒãƒ—</button>
            <button class="tutorial-btn tutorial-btn-next" onclick="nextTutorialStep()">æ¬¡ã¸</button>
        </div>
    </div>

    <!-- ãƒ˜ãƒ«ãƒ—ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="help-modal" id="helpModal">
        <div class="help-content">
            <div class="help-header">
                <h2>ğŸ“š ãƒ˜ãƒ«ãƒ— & ã‚¬ã‚¤ãƒ‰</h2>
                <p>PhotoEdit Helper ã®ä½¿ã„æ–¹ã‚’ãƒã‚¹ã‚¿ãƒ¼ã—ã¾ã—ã‚‡ã†</p>
                <button class="help-close" onclick="closeHelp()">âœ•</button>
            </div>
            
            <div class="help-tabs">
                <button class="help-tab active" onclick="switchHelpTab('basics')">åŸºæœ¬æ“ä½œ</button>
                <button class="help-tab" onclick="switchHelpTab('features')">æ©Ÿèƒ½ä¸€è¦§</button>
                <button class="help-tab" onclick="switchHelpTab('shortcuts')">ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ</button>
                <button class="help-tab" onclick="switchHelpTab('faq')">ã‚ˆãã‚ã‚‹è³ªå•</button>
            </div>

            <div class="help-body">
                <!-- åŸºæœ¬æ“ä½œ -->
                <div class="help-section active" id="basics-section">
                    <h3>ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆã‚¬ã‚¤ãƒ‰</h3>
                    <div class="feature-grid">
                        <div class="feature-card" onclick="highlightFeature('upload')">
                            <div class="feature-icon">ğŸ“¸</div>
                            <div class="feature-title">1. ç”»åƒã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</div>
                            <div class="feature-description">
                                ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã¾ãŸã¯ã‚¯ãƒªãƒƒã‚¯ã§ç”»åƒã‚’é¸æŠã—ã¾ã™ã€‚
                                å¯¾å¿œå½¢å¼ï¼šJPG, PNG, GIF, WebP
                            </div>
                        </div>
                        <div class="feature-card" onclick="highlightFeature('adjust')">
                            <div class="feature-icon">ğŸ¨</div>
                            <div class="feature-title">2. è‰²èª¿æ•´</div>
                            <div class="feature-description">
                                ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’å‹•ã‹ã—ã¦æ˜åº¦ã€å½©åº¦ã€è‰²ç›¸ãªã©ã‚’èª¿æ•´ã—ã¾ã™ã€‚
                                ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒæ›´æ–°ã•ã‚Œã¾ã™ã€‚
                            </div>
                        </div>
                        <div class="feature-card" onclick="highlightFeature('filter')">
                            <div class="feature-icon">âœ¨</div>
                            <div class="feature-title">3. ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨</div>
                            <div class="feature-description">
                                ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§ãƒ—ãƒ­ä¸¦ã¿ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’é©ç”¨ã§ãã¾ã™ã€‚
                                è¤‡æ•°ã®ãƒ—ãƒªã‚»ãƒƒãƒˆã‹ã‚‰é¸æŠå¯èƒ½ã§ã™ã€‚
                            </div>
                        </div>
                        <div class="feature-card" onclick="highlightFeature('download')">
                            <div class="feature-icon">ğŸ’¾</div>
                            <div class="feature-title">4. ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</div>
                            <div class="feature-description">
                                ç·¨é›†ãŒå®Œäº†ã—ãŸã‚‰ã€é«˜å“è³ªãªç”»åƒã¨ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ã€‚
                                å…ƒã®è§£åƒåº¦ã‚’ç¶­æŒã—ã¾ã™ã€‚
                            </div>
                        </div>
                    </div>
                </div>

                <!-- æ©Ÿèƒ½ä¸€è¦§ -->
                <div class="help-section" id="features-section">
                    <h3>ğŸ› ï¸ åˆ©ç”¨å¯èƒ½ãªæ©Ÿèƒ½</h3>
                    <div class="feature-grid">
                        <div class="feature-card">
                            <div class="feature-icon">â˜€ï¸</div>
                            <div class="feature-title">æ˜åº¦èª¿æ•´</div>
                            <div class="feature-description">
                                ç”»åƒå…¨ä½“ã®æ˜ã‚‹ã•ã‚’0%ã€œ200%ã®ç¯„å›²ã§èª¿æ•´ã§ãã¾ã™ã€‚
                                æš—ã„å†™çœŸã‚’æ˜ã‚‹ãã€æ˜ã‚‹ã™ãã‚‹å†™çœŸã‚’é©åº¦ã«æš—ãã§ãã¾ã™ã€‚
                            </div>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">ğŸŒˆ</div>
                            <div class="feature-title">å½©åº¦èª¿æ•´</div>
                            <div class="feature-description">
                                è‰²ã®é®®ã‚„ã‹ã•ã‚’èª¿æ•´ã—ã¾ã™ã€‚0%ã§ã‚°ãƒ¬ãƒ¼ã‚¹ã‚±ãƒ¼ãƒ«ã€
                                200%ã§æœ€å¤§ã®é®®ã‚„ã‹ã•ã«ãªã‚Šã¾ã™ã€‚
                            </div>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">ğŸ¨</div>
                            <div class="feature-title">è‰²ç›¸å¤‰æ›´</div>
                            <div class="feature-description">
                                -180Â°ã€œ180Â°ã®ç¯„å›²ã§è‰²ç›¸ã‚’å›è»¢ã•ã›ã€
                                ç”»åƒå…¨ä½“ã®è‰²èª¿ã‚’å¤‰æ›´ã§ãã¾ã™ã€‚
                            </div>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">âš¡</div>
                            <div class="feature-title">ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆ</div>
                            <div class="feature-description">
                                æ˜æš—ã®å·®ã‚’èª¿æ•´ã—ã¦ã€ãƒ¡ãƒªãƒãƒªã®ã‚ã‚‹ç”»åƒã«ä»•ä¸Šã’ã¾ã™ã€‚
                                0%ã€œ200%ã®ç¯„å›²ã§èª¿æ•´å¯èƒ½ã§ã™ã€‚
                            </div>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">ğŸŒ¡ï¸</div>
                            <div class="feature-title">è‰²æ¸©åº¦</div>
                            <div class="feature-description">
                                æš–è‰²ç³»ãƒ»å¯’è‰²ç³»ã®èª¿æ•´ãŒã§ãã¾ã™ã€‚
                                å†™çœŸã®é›°å›²æ°—ã‚’å¤§ããå¤‰ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
                            </div>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">ğŸ­</div>
                            <div class="feature-title">ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼</div>
                            <div class="feature-description">
                                ã‚»ãƒ”ã‚¢ã€ã‚°ãƒ¬ãƒ¼ã‚¹ã‚±ãƒ¼ãƒ«ã€ãƒ“ãƒ³ãƒ†ãƒ¼ã‚¸ãªã©ã€
                                æ§˜ã€…ãªãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§é©ç”¨ã§ãã¾ã™ã€‚
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ -->
                <div class="help-section" id="shortcuts-section">
                    <h3>âŒ¨ï¸ ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ</h3>
                    <table class="shortcut-table">
                        <thead>
                            <tr>
                                <th>æ“ä½œ</th>
                                <th>Windows/Linux</th>
                                <th>Mac</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>ç”»åƒã‚’é–‹ã</td>
                                <td><span class="shortcut-key">Ctrl</span> + <span class="shortcut-key">O</span></td>
                                <td><span class="shortcut-key">âŒ˜</span> + <span class="shortcut-key">O</span></td>
                            </tr>
                            <tr>
                                <td>ä¿å­˜/ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</td>
                                <td><span class="shortcut-key">Ctrl</span> + <span class="shortcut-key">S</span></td>
                                <td><span class="shortcut-key">âŒ˜</span> + <span class="shortcut-key">S</span></td>
                            </tr>
                            <tr>
                                <td>ãƒªã‚»ãƒƒãƒˆ</td>
                                <td><span class="shortcut-key">Ctrl</span> + <span class="shortcut-key">R</span></td>
                                <td><span class="shortcut-key">âŒ˜</span> + <span class="shortcut-key">R</span></td>
                            </tr>
                            <tr>
                                <td>ãƒ˜ãƒ«ãƒ—ã‚’é–‹ã</td>
                                <td><span class="shortcut-key">F1</span> or <span class="shortcut-key">?</span></td>
                                <td><span class="shortcut-key">F1</span> or <span class="shortcut-key">?</span></td>
                            </tr>
                            <tr>
                                <td>ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³</td>
                                <td><span class="shortcut-key">F11</span></td>
                                <td><span class="shortcut-key">âŒ˜</span> + <span class="shortcut-key">F</span></td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <h4 style="margin-top: 30px;">ğŸ’¡ ãƒ’ãƒ³ãƒˆ</h4>
                    <ul style="line-height: 1.8; color: #666;">
                        <li>ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã«ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™</li>
                        <li>Shiftã‚­ãƒ¼ã‚’æŠ¼ã—ãªãŒã‚‰ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’å‹•ã‹ã™ã¨ã€ç´°ã‹ã„èª¿æ•´ãŒã§ãã¾ã™</li>
                        <li>ç”»åƒä¸Šã§å³ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</li>
                    </ul>
                </div>

                <!-- FAQ -->
                <div class="help-section" id="faq-section">
                    <h3>â“ ã‚ˆãã‚ã‚‹è³ªå•</h3>
                    
                    <div class="faq-item">
                        <button class="faq-question" onclick="toggleFaq(this)">
                            <span>å¯¾å¿œã—ã¦ã„ã‚‹ç”»åƒå½¢å¼ã¯ä½•ã§ã™ã‹ï¼Ÿ</span>
                            <span class="faq-arrow">â–¼</span>
                        </button>
                        <div class="faq-answer">
                            JPG, JPEG, PNG, GIF, WebP, BMPå½¢å¼ã«å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚
                            æœ€å¤§ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã¯10MBã¾ã§ã§ã™ã€‚é«˜è§£åƒåº¦ã®ç”»åƒã‚‚å‡¦ç†å¯èƒ½ã§ã™ãŒã€
                            ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’è€ƒæ…®ã—ã¦4000x4000ãƒ”ã‚¯ã‚»ãƒ«ä»¥ä¸‹ã‚’æ¨å¥¨ã—ã¾ã™ã€‚
                        </div>
                    </div>

                    <div class="faq-item">
                        <button class="faq-question" onclick="toggleFaq(this)">
                            <span>ç·¨é›†ã—ãŸç”»åƒã®å“è³ªã¯è½ã¡ã¾ã™ã‹ï¼Ÿ</span>
                            <span class="faq-arrow">â–¼</span>
                        </button>
                        <div class="faq-answer">
                            ç·¨é›†å‡¦ç†ã¯éç ´å£Šçš„ã«è¡Œã‚ã‚Œã€å…ƒã®ç”»åƒå“è³ªã‚’å¯èƒ½ãªé™ã‚Šä¿æŒã—ã¾ã™ã€‚
                            ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ™‚ã¯PNGå½¢å¼ã§ä¿å­˜ã•ã‚Œã‚‹ãŸã‚ã€åœ§ç¸®ã«ã‚ˆã‚‹åŠ£åŒ–ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
                            ãŸã ã—ã€æ¥µç«¯ãªãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨æ™‚ã¯è‹¥å¹²ã®å“è³ªä½ä¸‹ãŒç”Ÿã˜ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚
                        </div>
                    </div>

                    <div class="faq-item">
                        <button class="faq-question" onclick="toggleFaq(this)">
                            <span>ç·¨é›†å†…å®¹ã‚’å…ƒã«æˆ»ã™ã“ã¨ã¯ã§ãã¾ã™ã‹ï¼Ÿ</span>
                            <span class="faq-arrow">â–¼</span>
                        </button>
                        <div class="faq-answer">
                            ã¯ã„ã€ã€Œãƒªã‚»ãƒƒãƒˆã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã‹ã€Ctrl+Rï¼ˆMac: âŒ˜+Rï¼‰ã‚’æŠ¼ã™ã“ã¨ã§ã€
                            ã™ã¹ã¦ã®ç·¨é›†ã‚’å…ƒã«æˆ»ã™ã“ã¨ãŒã§ãã¾ã™ã€‚å€‹åˆ¥ã®ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€
                            ãã®é …ç›®ã ã‘ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã«æˆ»ã™ã“ã¨ã‚‚ã§ãã¾ã™ã€‚
                        </div>
                    </div>

                    <div class="faq-item">
                        <button class="faq-question" onclick="toggleFaq(this)">
                            <span>ãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒã‚¤ã‚¹ã§ã‚‚ä½¿ç”¨ã§ãã¾ã™ã‹ï¼Ÿ</span>
                            <span class="faq-arrow">â–¼</span>
                        </button>
                        <div class="faq-answer">
                            ã¯ã„ã€ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ã«å¯¾å¿œã—ã¦ã„ã‚‹ãŸã‚ã€ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã‚„ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆã§ã‚‚
                            ä½¿ç”¨å¯èƒ½ã§ã™ã€‚ãŸã ã—ã€å¤§ããªç”»åƒã®å‡¦ç†ã«ã¯PCã®ä½¿ç”¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚
                            ã‚¿ãƒƒãƒæ“ä½œã«ã‚‚å¯¾å¿œã—ã¦ãŠã‚Šã€ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®èª¿æ•´ã‚‚å•é¡Œãªãè¡Œãˆã¾ã™ã€‚
                        </div>
                    </div>

                    <div class="faq-item">
                        <button class="faq-question" onclick="toggleFaq(this)">
                            <span>ç”»åƒãƒ‡ãƒ¼ã‚¿ã¯ä¿å­˜ã•ã‚Œã¾ã™ã‹ï¼Ÿ</span>
                            <span class="faq-arrow">â–¼</span>
                        </button>
                        <div class="faq-answer">
                            ã„ã„ãˆã€ã“ã®ãƒ„ãƒ¼ãƒ«ã¯å®Œå…¨ã«ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã§å‹•ä½œã—ã€ç”»åƒãƒ‡ãƒ¼ã‚¿ã¯ä¸€åˆ‡ã‚µãƒ¼ãƒãƒ¼ã«
                            é€ä¿¡ã•ã‚Œã¾ã›ã‚“ã€‚ã™ã¹ã¦ã®å‡¦ç†ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã§è¡Œã‚ã‚Œã‚‹ãŸã‚ã€ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã¯
                            å®Œå…¨ã«ä¿è­·ã•ã‚Œã¾ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‰ã˜ã‚‹ã¨ã€ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã¯å‰Šé™¤ã•ã‚Œã¾ã™ã€‚
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ãƒ¡ã‚¤ãƒ³ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="header">
        <h1>ğŸ¨ æ¶ç©ºã® PhotoEdit Helper</h1>
        <p>åˆå¿ƒè€…ã«ã‚‚å„ªã—ã„ã€ãƒ˜ãƒ«ãƒ—å……å®Ÿã®ç”»åƒç·¨é›†ãƒ„ãƒ¼ãƒ«</p>
        <button class="help-button" onclick="openHelp()">â“ ãƒ˜ãƒ«ãƒ—</button>
    </div>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ -->
    <div class="main-container">
        <!-- ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒªã‚¢ -->
        <div class="upload-area" id="uploadArea">
            <div class="help-icon" onclick="showUploadHelp(event)">?</div>
            <div class="tooltip" id="uploadTooltip">
                ç”»åƒã‚’ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã™ã‚‹ã‹ã€ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠã—ã¦ãã ã•ã„
            </div>
            <div class="upload-icon">ğŸ“¸</div>
            <div class="upload-text">ç”»åƒã‚’ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—</div>
            <div class="upload-subtext">ã¾ãŸã¯ ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠ</div>
            <input type="file" id="fileInput" accept="image/*">
        </div>

        <!-- ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã‚³ãƒ³ãƒ†ãƒŠ -->
        <div class="editor-container" id="editorContainer">
            <div class="preview-container">
                <div class="help-icon" onclick="showPreviewHelp(event)">?</div>
                <div class="tooltip" id="previewTooltip">
                    ç·¨é›†çµæœãŒãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§è¡¨ç¤ºã•ã‚Œã¾ã™
                </div>
                <div class="canvas-wrapper">
                    <canvas id="canvas"></canvas>
                </div>
                <button class="btn btn-secondary" id="newImageBtn">åˆ¥ã®ç”»åƒã‚’é¸æŠ</button>
            </div>

            <div class="controls-panel">
                <div class="help-icon" onclick="showControlsHelp(event)">?</div>
                <div class="tooltip" id="controlsTooltip">
                    å„ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã§ç”»åƒã‚’èª¿æ•´ã§ãã¾ã™
                </div>

                <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ—ãƒªã‚»ãƒƒãƒˆ -->
                <div class="control-group">
                    <label class="control-label">
                        <span>ğŸ­ ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼</span>
                    </label>
                    <div class="filter-presets">
                        <button class="filter-btn active" data-filter="none">ãªã—</button>
                        <button class="filter-btn" data-filter="grayscale">ã‚°ãƒ¬ãƒ¼</button>
                        <button class="filter-btn" data-filter="sepia">ã‚»ãƒ”ã‚¢</button>
                        <button class="filter-btn" data-filter="vintage">ãƒ“ãƒ³ãƒ†ãƒ¼ã‚¸</button>
                        <button class="filter-btn" data-filter="cold">ã‚¯ãƒ¼ãƒ«</button>
                        <button class="filter-btn" data-filter="warm">ã‚¦ã‚©ãƒ¼ãƒ </button>
                    </div>
                </div>

                <!-- åŸºæœ¬èª¿æ•´ -->
                <div class="control-group">
                    <label class="control-label">
                        <span>ğŸ¨ è‰²ç›¸ï¼ˆHueï¼‰</span>
                        <span class="control-value" id="hueValue">0Â°</span>
                    </label>
                    <input type="range" class="slider hue-slider" id="hueSlider" min="-180" max="180" value="0">
                </div>

                <div class="control-group">
                    <label class="control-label">
                        <span>ğŸŒˆ å½©åº¦ï¼ˆSaturationï¼‰</span>
                        <span class="control-value" id="saturationValue">100%</span>
                    </label>
                    <input type="range" class="slider" id="saturationSlider" min="0" max="200" value="100">
                </div>

                <div class="control-group">
                    <label class="control-label">
                        <span>â˜€ï¸ æ˜åº¦ï¼ˆBrightnessï¼‰</span>
                        <span class="control-value" id="brightnessValue">100%</span>
                    </label>
                    <input type="range" class="slider" id="brightnessSlider" min="0" max="200" value="100">
                </div>

                <div class="control-group">
                    <label class="control-label">
                        <span>âš¡ ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆ</span>
                        <span class="control-value" id="contrastValue">100%</span>
                    </label>
                    <input type="range" class="slider" id="contrastSlider" min="0" max="200" value="100">
                </div>

                <div class="control-group">
                    <label class="control-label">
                        <span>ğŸŒ¡ï¸ è‰²æ¸©åº¦</span>
                        <span class="control-value" id="temperatureValue">0</span>
                    </label>
                    <input type="range" class="slider" id="temperatureSlider" min="-100" max="100" value="0">
                </div>

                <div class="action-buttons">
                    <button class="btn btn-secondary" id="resetBtn">
                        <span class="help-icon" style="position: absolute; top: -10px; right: -10px;" onclick="showResetHelp(event)">?</span>
                        ãƒªã‚»ãƒƒãƒˆ
                    </button>
                    <button class="btn btn-primary" id="downloadBtn">
                        <span class="help-icon" style="position: absolute; top: -10px; right: -10px;" onclick="showDownloadHelp(event)">?</span>
                        ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ˜ãƒ«ãƒ—ãƒœã‚¿ãƒ³ -->
    <div class="floating-help pulse" onclick="openHelp()" title="ãƒ˜ãƒ«ãƒ—ã‚’é–‹ã">
        ?
    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let originalImage = null;
        let currentImage = new Image();
        let currentFilter = 'none';
        let tutorialStep = 0;
        let isFirstVisit = !localStorage.getItem('hasVisited');

        // ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚¹ãƒ†ãƒƒãƒ—
        const tutorialSteps = [
            {
                element: '#uploadArea',
                title: 'ã‚¹ãƒ†ãƒƒãƒ— 1: ç”»åƒã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰',
                text: 'ã¾ãšã¯ç·¨é›†ã—ãŸã„ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ã‚‡ã†ã€‚ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã¾ãŸã¯ã‚¯ãƒªãƒƒã‚¯ã§é¸æŠã§ãã¾ã™ã€‚'
            },
            {
                element: '.filter-presets',
                title: 'ã‚¹ãƒ†ãƒƒãƒ— 2: ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’é¸æŠ',
                text: 'ãƒ—ãƒªã‚»ãƒƒãƒˆãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‹ã‚‰å¥½ããªåŠ¹æœã‚’é¸ã‚“ã§ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§é©ç”¨ã§ãã¾ã™ã€‚'
            },
            {
                element: '#hueSlider',
                title: 'ã‚¹ãƒ†ãƒƒãƒ— 3: è‰²ç›¸ã®èª¿æ•´',
                text: 'ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’å‹•ã‹ã—ã¦ã€ç”»åƒã®è‰²èª¿ã‚’è‡ªç”±ã«å¤‰æ›´ã§ãã¾ã™ã€‚èµ¤ã€é’ã€ç·‘ãªã©æ§˜ã€…ãªè‰²ã«å¤‰æ›å¯èƒ½ã§ã™ã€‚'
            },
            {
                element: '.action-buttons',
                title: 'ã‚¹ãƒ†ãƒƒãƒ— 4: ä¿å­˜',
                text: 'ç·¨é›†ãŒå®Œäº†ã—ãŸã‚‰ã€ãƒªã‚»ãƒƒãƒˆã§å…ƒã«æˆ»ã—ãŸã‚Šã€ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ä¿å­˜ã§ãã¾ã™ã€‚'
            }
        ];

        // DOMè¦ç´ ã®å–å¾—
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const editorContainer = document.getElementById('editorContainer');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const newImageBtn = document.getElementById('newImageBtn');
        const resetBtn = document.getElementById('resetBtn');
        const downloadBtn = document.getElementById('downloadBtn');

        // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼è¦ç´ 
        const sliders = {
            hue: document.getElementById('hueSlider'),
            saturation: document.getElementById('saturationSlider'),
            brightness: document.getElementById('brightnessSlider'),
            contrast: document.getElementById('contrastSlider'),
            temperature: document.getElementById('temperatureSlider')
        };

        // å€¤è¡¨ç¤ºè¦ç´ 
        const values = {
            hue: document.getElementById('hueValue'),
            saturation: document.getElementById('saturationValue'),
            brightness: document.getElementById('brightnessValue'),
            contrast: document.getElementById('contrastValue'),
            temperature: document.getElementById('temperatureValue')
        };

        // åˆæœŸåŒ–
        window.addEventListener('load', () => {
            if (isFirstVisit) {
                showOnboarding();
            }
            setupEventListeners();
            setupTooltips();
        });

        // ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
        function showOnboarding() {
            document.getElementById('onboardingModal').classList.add('active');
        }

        // ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ã‚­ãƒƒãƒ—
        function skipOnboarding() {
            document.getElementById('onboardingModal').classList.remove('active');
            localStorage.setItem('hasVisited', 'true');
            document.querySelector('.floating-help').classList.remove('pulse');
        }

        // ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«é–‹å§‹
        function startTutorial() {
            document.getElementById('onboardingModal').classList.remove('active');
            localStorage.setItem('hasVisited', 'true');
            tutorialStep = 0;
            showTutorialStep();
        }

        // ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚¹ãƒ†ãƒƒãƒ—è¡¨ç¤º
        function showTutorialStep() {
            if (tutorialStep >= tutorialSteps.length) {
                endTutorial();
                return;
            }

            const step = tutorialSteps[tutorialStep];
            const element = document.querySelector(step.element);
            
            if (element) {
                const rect = element.getBoundingClientRect();
                const highlight = document.getElementById('tutorialHighlight');
                const tooltip = document.getElementById('tutorialTooltip');
                
                // ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤º
                highlight.style.display = 'block';
                highlight.style.left = rect.left - 5 + 'px';
                highlight.style.top = rect.top - 5 + 'px';
                highlight.style.width = rect.width + 10 + 'px';
                highlight.style.height = rect.height + 10 + 'px';
                
                // ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—è¡¨ç¤º
                tooltip.style.display = 'block';
                tooltip.style.left = rect.right + 20 + 'px';
                tooltip.style.top = rect.top + 'px';
                
                document.getElementById('tutorialTitle').textContent = step.title;
                document.getElementById('tutorialText').textContent = step.text;
                
                document.getElementById('tutorialOverlay').classList.add('active');
            }
        }

        // æ¬¡ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚¹ãƒ†ãƒƒãƒ—
        function nextTutorialStep() {
            tutorialStep++;
            showTutorialStep();
        }

        // ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚¹ã‚­ãƒƒãƒ—
        function skipTutorial() {
            endTutorial();
        }

        // ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«çµ‚äº†
        function endTutorial() {
            document.getElementById('tutorialOverlay').classList.remove('active');
            document.getElementById('tutorialHighlight').style.display = 'none';
            document.getElementById('tutorialTooltip').style.display = 'none';
            document.querySelector('.floating-help').classList.remove('pulse');
        }

        // ãƒ˜ãƒ«ãƒ—ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
        function openHelp() {
            document.getElementById('helpModal').classList.add('active');
            document.querySelector('.floating-help').classList.remove('pulse');
        }

        // ãƒ˜ãƒ«ãƒ—ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
        function closeHelp() {
            document.getElementById('helpModal').classList.remove('active');
        }

        // ãƒ˜ãƒ«ãƒ—ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        function switchHelpTab(tab) {
            // ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã®æ›´æ–°
            document.querySelectorAll('.help-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            // ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®æ›´æ–°
            document.querySelectorAll('.help-section').forEach(s => s.classList.remove('active'));
            document.getElementById(tab + '-section').classList.add('active');
        }

        // FAQé–‹é–‰
        function toggleFaq(button) {
            const answer = button.nextElementSibling;
            button.classList.toggle('active');
            answer.classList.toggle('active');
        }

        // æ©Ÿèƒ½ãƒã‚¤ãƒ©ã‚¤ãƒˆ
        function highlightFeature(feature) {
            closeHelp();
            // å®Ÿéš›ã®è¦ç´ ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤º
            let element;
            switch(feature) {
                case 'upload':
                    element = uploadArea;
                    break;
                case 'adjust':
                    element = document.querySelector('.controls-panel');
                    break;
                case 'filter':
                    element = document.querySelector('.filter-presets');
                    break;
                case 'download':
                    element = downloadBtn;
                    break;
            }
            
            if (element) {
                element.scrollIntoView({ behavior: 'smooth', block: 'center' });
                element.style.animation = 'pulse 2s';
                setTimeout(() => {
                    element.style.animation = '';
                }, 2000);
            }
        }

        // ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—è¨­å®š
        function setupTooltips() {
            // ãƒ˜ãƒ«ãƒ—ã‚¢ã‚¤ã‚³ãƒ³ã®ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—
            document.querySelectorAll('.help-icon').forEach(icon => {
                icon.addEventListener('mouseenter', (e) => {
                    e.stopPropagation();
                    const tooltipId = icon.parentElement.querySelector('.tooltip')?.id;
                    if (tooltipId) {
                        const tooltip = document.getElementById(tooltipId);
                        if (tooltip) {
                            tooltip.classList.add('active');
                            const rect = icon.getBoundingClientRect();
                            tooltip.style.left = rect.left - tooltip.offsetWidth / 2 + 15 + 'px';
                            tooltip.style.top = rect.top - tooltip.offsetHeight - 10 + 'px';
                        }
                    }
                });
                
                icon.addEventListener('mouseleave', () => {
                    document.querySelectorAll('.tooltip').forEach(t => t.classList.remove('active'));
                });
            });
        }

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
        function setupEventListeners() {
            // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
            uploadArea.addEventListener('click', () => fileInput.click());
            uploadArea.addEventListener('dragover', handleDragOver);
            uploadArea.addEventListener('dragleave', handleDragLeave);
            uploadArea.addEventListener('drop', handleDrop);
            fileInput.addEventListener('change', handleFileSelect);

            // ãƒœã‚¿ãƒ³
            newImageBtn.addEventListener('click', () => {
                fileInput.value = '';
                uploadArea.classList.remove('has-image');
                editorContainer.classList.remove('active');
                originalImage = null;
            });

            resetBtn.addEventListener('click', resetImage);
            downloadBtn.addEventListener('click', downloadImage);

            // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼
            Object.keys(sliders).forEach(key => {
                sliders[key].addEventListener('input', () => {
                    updateValueDisplay(key);
                    applyFilters();
                });
                
                // ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã§ãƒªã‚»ãƒƒãƒˆ
                sliders[key].addEventListener('dblclick', () => {
                    const defaults = {
                        hue: 0,
                        saturation: 100,
                        brightness: 100,
                        contrast: 100,
                        temperature: 0
                    };
                    sliders[key].value = defaults[key];
                    updateValueDisplay(key);
                    applyFilters();
                });
            });

            // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒœã‚¿ãƒ³
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentFilter = btn.dataset.filter;
                    applyFilters();
                });
            });

            // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
            document.addEventListener('keydown', (e) => {
                if (e.key === 'F1' || e.key === '?') {
                    e.preventDefault();
                    openHelp();
                }
                if ((e.ctrlKey || e.metaKey) && e.key === 'o') {
                    e.preventDefault();
                    fileInput.click();
                }
                if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                    e.preventDefault();
                    if (originalImage) downloadImage();
                }
                if ((e.ctrlKey || e.metaKey) && e.key === 'r') {
                    e.preventDefault();
                    if (originalImage) resetImage();
                }
            });
        }

        // ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—å‡¦ç†
        function handleDragOver(e) {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        }

        function handleDragLeave() {
            uploadArea.classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        }

        function handleFileSelect(e) {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        }

        // ãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†
        function handleFile(file) {
            if (!file.type.startsWith('image/')) {
                alert('ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                currentImage.onload = () => {
                    canvas.width = currentImage.width;
                    canvas.height = currentImage.height;
                    ctx.drawImage(currentImage, 0, 0);
                    
                    originalImage = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    
                    uploadArea.classList.add('has-image');
                    editorContainer.classList.add('active');
                    
                    fitCanvasToContainer();
                };
                currentImage.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚µã‚¤ã‚ºèª¿æ•´
        function fitCanvasToContainer() {
            const maxWidth = 600;
            const scale = Math.min(1, maxWidth / canvas.width);
            canvas.style.width = (canvas.width * scale) + 'px';
            canvas.style.height = (canvas.height * scale) + 'px';
        }

        // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨
        function applyFilters() {
            if (!originalImage) return;

            const imageData = ctx.createImageData(originalImage.width, originalImage.height);
            const data = imageData.data;
            const original = originalImage.data;

            const hue = parseFloat(sliders.hue.value);
            const saturation = parseFloat(sliders.saturation.value) / 100;
            const brightness = parseFloat(sliders.brightness.value) / 100;
            const contrast = parseFloat(sliders.contrast.value) / 100;
            const temperature = parseFloat(sliders.temperature.value);

            for (let i = 0; i < original.length; i += 4) {
                let r = original[i];
                let g = original[i + 1];
                let b = original[i + 2];

                // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨
                if (currentFilter !== 'none') {
                    [r, g, b] = applyFilter(r, g, b, currentFilter);
                }

                // HSLå¤‰æ›ã¨èª¿æ•´
                let [h, s, l] = rgbToHsl(r, g, b);
                h = (h + hue + 360) % 360;
                s = Math.min(1, s * saturation);
                [r, g, b] = hslToRgb(h, s, l);

                // æ˜åº¦ãƒ»ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆèª¿æ•´
                r = Math.min(255, r * brightness);
                g = Math.min(255, g * brightness);
                b = Math.min(255, b * brightness);

                r = Math.min(255, Math.max(0, ((r - 128) * contrast) + 128));
                g = Math.min(255, Math.max(0, ((g - 128) * contrast) + 128));
                b = Math.min(255, Math.max(0, ((b - 128) * contrast) + 128));

                // è‰²æ¸©åº¦èª¿æ•´
                if (temperature > 0) {
                    r = Math.min(255, r + temperature);
                    b = Math.max(0, b - temperature);
                } else {
                    r = Math.max(0, r + temperature);
                    b = Math.min(255, b - temperature);
                }

                data[i] = r;
                data[i + 1] = g;
                data[i + 2] = b;
                data[i + 3] = original[i + 3];
            }

            ctx.putImageData(imageData, 0, 0);
        }

        // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼åŠ¹æœ
        function applyFilter(r, g, b, filter) {
            switch(filter) {
                case 'grayscale':
                    const gray = r * 0.299 + g * 0.587 + b * 0.114;
                    return [gray, gray, gray];
                case 'sepia':
                    return [
                        Math.min(255, (r * 0.393) + (g * 0.769) + (b * 0.189)),
                        Math.min(255, (r * 0.349) + (g * 0.686) + (b * 0.168)),
                        Math.min(255, (r * 0.272) + (g * 0.534) + (b * 0.131))
                    ];
                case 'vintage':
                    return [
                        Math.min(255, r * 1.2),
                        Math.min(255, g * 1.0),
                        Math.min(255, b * 0.8)
                    ];
                case 'cold':
                    return [r * 0.9, g, Math.min(255, b * 1.1)];
                case 'warm':
                    return [Math.min(255, r * 1.1), g, b * 0.9];
                default:
                    return [r, g, b];
            }
        }

        // RGB to HSL
        function rgbToHsl(r, g, b) {
            r /= 255;
            g /= 255;
            b /= 255;

            const max = Math.max(r, g, b);
            const min = Math.min(r, g, b);
            let h, s, l = (max + min) / 2;

            if (max === min) {
                h = s = 0;
            } else {
                const d = max - min;
                s = l > 0.5 ? d / (2 - max - min) : d / (max + min);

                switch (max) {
                    case r: h = ((g - b) / d + (g < b ? 6 : 0)) / 6; break;
                    case g: h = ((b - r) / d + 2) / 6; break;
                    case b: h = ((r - g) / d + 4) / 6; break;
                }
            }

            return [h * 360, s, l];
        }

        // HSL to RGB
        function hslToRgb(h, s, l) {
            h /= 360;
            let r, g, b;

            if (s === 0) {
                r = g = b = l;
            } else {
                const hue2rgb = (p, q, t) => {
                    if (t < 0) t += 1;
                    if (t > 1) t -= 1;
                    if (t < 1/6) return p + (q - p) * 6 * t;
                    if (t < 1/2) return q;
                    if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
                    return p;
                };

                const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
                const p = 2 * l - q;

                r = hue2rgb(p, q, h + 1/3);
                g = hue2rgb(p, q, h);
                b = hue2rgb(p, q, h - 1/3);
            }

            return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255)];
        }

        // å€¤è¡¨ç¤ºæ›´æ–°
        function updateValueDisplay(key) {
            const value = sliders[key].value;
            switch(key) {
                case 'hue':
                    values[key].textContent = `${value}Â°`;
                    break;
                case 'temperature':
                    values[key].textContent = value;
                    break;
                default:
                    values[key].textContent = `${value}%`;
            }
        }

        // ãƒªã‚»ãƒƒãƒˆå‡¦ç†
        function resetImage() {
            sliders.hue.value = 0;
            sliders.saturation.value = 100;
            sliders.brightness.value = 100;
            sliders.contrast.value = 100;
            sliders.temperature.value = 0;

            Object.keys(sliders).forEach(key => updateValueDisplay(key));
            
            currentFilter = 'none';
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('[data-filter="none"]').classList.add('active');
            
            if (originalImage) {
                ctx.putImageData(originalImage, 0, 0);
            }
        }

        // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å‡¦ç†
        function downloadImage() {
            const link = document.createElement('a');
            link.download = 'edited-image.png';
            link.href = canvas.toDataURL();
            link.click();
        }

        // å€‹åˆ¥ãƒ˜ãƒ«ãƒ—è¡¨ç¤ºé–¢æ•°
        function showUploadHelp(e) {
            e.stopPropagation();
        }

        function showPreviewHelp(e) {
            e.stopPropagation();
        }

        function showControlsHelp(e) {
            e.stopPropagation();
        }

        function showResetHelp(e) {
            e.stopPropagation();
            alert('ã™ã¹ã¦ã®ç·¨é›†ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦å…ƒã®ç”»åƒã«æˆ»ã—ã¾ã™');
        }

        function showDownloadHelp(e) {
            e.stopPropagation();
            alert('ç·¨é›†ã—ãŸç”»åƒã‚’PNGå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™');
        }
    </script>
</body>
</html>